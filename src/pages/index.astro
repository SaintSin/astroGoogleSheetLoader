---
// pages/index.astro
import { getConfiguredImageService, Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import Layout from '@layouts/BaseLayout.astro';

const meta = {
  title: 'Google Sheets Demo',
  description: 'Demonstrating Google Sheets content loader',
  imageOG: 'generic-social-1200x630.png',
  altOG: 'Alt text for OG image',
};

// Fetch data from Google Sheets via content collection
const products = await getCollection('products');
const reviews = await getCollection('reviews');

// Filter for just reviewID 3
// reviewID is now coerced to a number by the schema
const reviewID3 = reviews.find((review) => review.data.reviewID === 3);
---

<Layout metaData={meta}>
  <main class="wrapper flow">
    <h1>Google Sheets Content Loader Demo</h1>
    <p>
      This page demonstrates loading data from Google Sheets using Astro's
      content collections.
    </p>

    <section>
      <h2>Data from Google Sheets</h2>
      {
        products.length === 0 ? (
          <p>
            No data loaded. Make sure to configure your Google Sheets API key
            and Sheet ID in the .env file.
          </p>
        ) : (
          <div>
            <p>Loaded {products.length} rows from Google Sheets:</p>
            <ul>
              {products.map((item) => (
                <li>
                  <pre>{JSON.stringify(item.data, null, 2)}</pre>
                </li>
              ))}
            </ul>
          </div>
        )
      }
      <h3>All Reviews</h3>
      {
        reviews.length === 0 ? (
          <p>
            No data loaded. Make sure to configure your Google Sheets API key
            and Sheet ID in the .env file.
          </p>
        ) : (
          <div>
            <p>Loaded {reviews.length} rows from Google Sheets:</p>
            <ul>
              {reviews.map((item) => (
                <li>
                  <pre>{JSON.stringify(item.data, null, 2)}</pre>
                </li>
              ))}
            </ul>
          </div>
        )
      }

      <h3>Review ID 3 Only</h3>
      {
        reviewID3 ? (
          <div>
            <p>Found review with ID 3:</p>
            <pre>{JSON.stringify(reviewID3.data, null, 2)}</pre>
          </div>
        ) : (
          <p>Review with ID 3 not found.</p>
        )
      }
    </section>
  </main>
</Layout>
<style>
  pre {
    border-radius: 4px;
    background: #f4f4f4;
    padding: 1rem;
    overflow-x: auto;
  }

  ul {
    padding: 0;
    list-style: none;
  }

  li {
    margin-bottom: 1rem;
  }
</style>
